rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // 1. 連絡帳の本文 (日付ドキュメント)
    // 閲覧: 誰でもOK
    // 編集: 管理者 (d.a0807derude@gmail.com) のみOK
    match /class_notes/{date} {
      allow read: if true;
      allow write: if request.auth != null && request.auth.token.email == 'd.a0807derude@gmail.com';
    }

    // 2. 確認スタンプ (サブコレクション)
    // 閲覧・編集: 誰でもOK (保護者がスタンプを押すため)
    match /class_notes/{date}/checks/{checkId} {
      allow read, write: if true;
    }
  }
}
